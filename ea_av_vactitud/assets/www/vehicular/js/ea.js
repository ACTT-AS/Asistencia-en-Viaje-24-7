var EASync=JSON.parse(localStorage.getItem("EASync"))||{clientId:"-1",sessionId:"-1"},hddCanal="Europ",hddTipoAsistencia,myLocalStorage=window.localStorage;"1"===localStorage.getItem("okSolicitaAsistencia")&&myLocalStorage.setItem("okSolicitaAsistencia","0");var client,EA={};EA.version="0.2",EA.params={callNumber:"+56225606607",callPolice:"133",eabServer:"apps.actitudtecnologia.cl",eabPort:8e3},EA.sync=function(){EA.client=EASync,myLocalStorage.setItem("EASync",JSON.stringify(EASync))},EA.validaUsuario=function(){var t=JSON.parse(myLocalStorage.getItem("EASync"));return"-1"!=t.clientId?!0:!1},EA.registerUser=function(){var t={type:0,clientId:EA.client.clientId,data:{nombre:$("#txtNombre_reg").val(),rut:$("#txtRut_reg").val(),email:$("#txtEmail_reg").val(),patente:$("#txtPatente_reg").val(),prestador:$("#txtPrestador_reg").val(),tipo:"Solicitud de Registro",marca:$("#txtMarca_reg").val(),modelo:$("#txtModelo_reg").val(),telefono:$("#txtAno_reg").val()}};EAB.send({client:client,topicId:"/Clientes/"+EA.client.clientId,message:JSON.stringify(t)}),EASync.clientId=$("#txtRut_reg").val(),EASync.sessionId=$("#txtRut_reg").val(),EA.client=EASync,myLocalStorage.setItem("EASync",JSON.stringify(EASync)),myLocalStorage.setItem("prestador",$("#txtPrestador_reg").val()),myLocalStorage.setItem("nombre",$("#txtNombre_reg").val()),myLocalStorage.setItem("rut",$("#txtRut_reg").val()),myLocalStorage.setItem("patente",$("#txtPatente_reg").val()),myLocalStorage.setItem("email",$("#txtEmail_reg").val()),myLocalStorage.setItem("telefono",$("#txtAno_reg").val()),location.reload()},EA.solicitaAsistencia=function(){var t={type:2,clientId:client.clientId,data:{canal:hddCanal,nombre:$("#txtNombre_ass").val(),rut:$("#txtRut_ass").val(),email:myLocalStorage.getItem("email"),tipo:"Solicitud de Asistencia",detalle:myLocalStorage.getItem("hddTipoAsistencia"),patente:$("#txtPatente_ass").val(),direccion:$("#txtDireccion_ass").val(),comuna:$("#txtComuna_ass").val(),ciudad:$("#txtCiudad_ass").val(),telefono:myLocalStorage.getItem("telefono")}};EAB.send({client:EAB.client,topicId:"/Clientes/"+client.clientId,message:JSON.stringify(t)}),myLocalStorage.setItem("okSolicitaAsistencia","1"),myLocalStorage.setItem("solEnviada","1"),window.location.replace("solicita1.html")},EA.callEA=function(){var t={type:3,clientId:EASync.clientId,data:"Llamando a EA"};EAB.send({client:EAB.client,topicId:"/Clientes/"+client.clientId,message:JSON.stringify(t)}),window.location.href="tel:"+EA.params.callNumber},EA.attachEvents=function(){$("#enviarRegistro").click(function(){console.log("validando....");var t=$("#txtNombre_reg").val(),e=$("#txtRut_reg").val(),a=$("#txtPatente_reg").val(),o=$("#txtEmail_reg").val(),l=$("#txtAno_reg").val();EA.validate(t)&&EA.validate(e)&&EA.validate(a)&&EA.Rut(e)&&EA.validate(o)&&EA.validaEmail(o)&&EA.validate(l)?(EA.registerUser(),window.location.replace("solicita1.html")):(EA.validate(t)?$("#txtNombre_reg").css("background-color","#fff"):($("#txtNombre_reg").css("background-color","#ffebe5"),$("#txtNombre_reg").attr("placeholder","Debe ingresar Nombre")),EA.validate(e)?$("#txtRut_reg").css("background-color","#fff"):($("#txtRut_reg").css("background-color","#ffebe5"),$("#txtRut_reg").attr("placeholder","Debe ingresar Rut")),EA.validate(a)?$("#txtPatente_reg").css("background-color","#fff"):($("#txtPatente_reg").css("background-color","#ffebe5"),$("#txtPatente_reg").attr("placeholder","Debe ingresar Patente")),EA.Rut(e)?$("#txtRut_reg").css("background-color","#fff"):($("#txtRut_reg").css("background-color","#ffebe5"),$("#txtRut_reg").attr("placeholder","Debe ingresar un rut valido")),EA.validate(o)?$("#txtEmail_reg").css("background-color","#fff"):($("#txtEmail_reg").css("background-color","#ffebe5"),$("#txtEmail_reg").attr("placeholder","Debe ingresar Email")),EA.validaEmail(o)?$("#txtEmail_reg").css("background-color","#fff"):($("#txtEmail_reg").css("background-color","#ffebe5"),$("#txtEmail_reg").attr("placeholder","Debe ingresar Email válido")),EA.validate(l)?$("#txtAno_reg").css("background-color","#fff"):($("#txtAno_reg").css("background-color","#ffebe5"),$("#txtAno_reg").attr("placeholder","Debe ingresar teléfono de contacto")))})},EA.validate=function(t){return iValid=!1,iValid=""==t?!1:!0,iValid},EA.startSession=function(){client=new EAB.createClient(EASync.clientId);var t={type:1,clientId:EASync.clientId,data:"OK"};client.connect({onSuccess:function(){client.subscribe("/Clientes/"+EASync.clientId),EAB.send({client:client,topicId:"/Clientes",message:JSON.stringify(t)})}}),client.onConnectionLost=function(){},client.onMessageArrived=function(){}},EA.init=function(){EA.sync(),EA.startSession(),EA.attachEvents(),EA.validaUsuario()&&(myLocalStorage.setItem("solEnviada","0"),window.location.replace("solicita1.html"))},EA.Rut=function(t){var e=t,a=e.search(/-/i),o=!1;if(7==a||8==a){var l=e.split("-");T=l[0];for(var r,i=0,n=1;T;T=Math.floor(T/10))n=(n+T%10*(9-i++%6))%11,r=n?n-1:"k";r.toString().toUpperCase()==l[1].toString().toUpperCase()&&(o=!0)}return console.log(o),o},EA.validaEmail=function(t){expr=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;var e=!0;return expr.test(t)||(e=!1),e};