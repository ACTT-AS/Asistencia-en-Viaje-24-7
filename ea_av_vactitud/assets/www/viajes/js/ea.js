var EASync_av=JSON.parse(localStorage.getItem("EASync_av"))||{clientId:"-1",sessionId:"-1"},hddCanal="Europ AV",hddTipoAsistencia,myLocalStorage=window.localStorage;"1"===localStorage.getItem("okSolicitaAsistencia_viaje")&&myLocalStorage.setItem("okSolicitaAsistencia_viaje","0");var client,EA={};EA.version="0.2",EA.params={callNumber:"+56225606607",callPolice:"133",eabServer:"apps.actitudtecnologia.cl",eabPort:8e3},EA.sync=function(){EA.client=EASync_av,myLocalStorage.setItem("EASync_av",JSON.stringify(EASync_av))},EA.validaUsuario=function(){var t=JSON.parse(myLocalStorage.getItem("EASync_av"));return"-1"!=t.clientId?!0:!1},EA.registerUser=function(){var t={type:4,clientId:EA.client.clientId,data:{nombre_titular:$("#txtNombre_reg_av").val(),rut_titular:$("#txtRut_reg_av").val(),fechaNacimiento_titular:$("#txtFec_nac").val(),prestador:$("#txtPrestador_reg_av option:selected").text(),tipo:"Solicitud de Registro Asistencia en Viaje"}};EAB.send({client:client,topicId:"/Clientes/"+EA.client.clientId,message:JSON.stringify(t)}),EASync_av.clientId=$("#txtRut_reg").val(),EASync_av.sessionId=$("#txtRut_reg").val(),EA.client=EASync_av,myLocalStorage.setItem("EASync_av",JSON.stringify(EASync_av)),myLocalStorage.setItem("nombre_titular",$("#txtNombre_reg_av").val()),myLocalStorage.setItem("rut_titular",$("#txtRut_reg_av").val()),myLocalStorage.setItem("fechaNacimiento_titular",$("#txtFec_nac").val()),myLocalStorage.setItem("prestador_av",$("#txtPrestador_reg_av option:selected").text()),location.reload()},EA.solicitaAsistencia=function(){var t,e,a,o=JSON.parse(myLocalStorage.getItem("companies")),c=$("#txtNombrePac_ass").val(),i=$("#txtRutPac_ass").val(),r=$("#txtFecSalida_ass").val(),n=$("#txtFecRegreso_ass").val(),l=$("#txtObservacion_ass").val(),s=$("#txtFecOcurrencia_ass").val(),d=$("#txtDireccion_ass").val(),v=$("#txtTelefono_ass").val(),_=$("#txtEmail_ass").val(),g=myLocalStorage.getItem("nombre_titular"),m=myLocalStorage.getItem("rut_titular"),u=myLocalStorage.getItem("fechaNacimiento_titular"),A=myLocalStorage.getItem("prestador_av");$.grep(o,function(o){o.nombre==myLocalStorage.getItem("prestador_av")&&(t=o.VDN,e=o.mail,a=o.telefono)});var E={type:5,clientId:client.clientId,data:{canal:hddCanal,nombre_paciente:c,rut_paciente:i,email:_,tipo:"Solicitud de Asistencia en Viaje",fecha_salida:r,fecha_regreso:n,observacion:l,direccion:d,fecha_ocurrencia:s,telefono:v,email:_,nombre_titular:g,rut_titular:m,fechaNacimiento_titular:u,prestador:A,vdn_prestador:t,mail_prestador:e,telefono_prestador:a}};EAB.send({client:EAB.client,topicId:"/Clientes/"+client.clientId,message:JSON.stringify(E)}),myLocalStorage.setItem("okSolicitaAsistencia_viaje","1"),myLocalStorage.setItem("solEnviada_viaje","1"),window.location.replace("solicita1.html")},EA.callEA=function(){var t={type:3,clientId:EASync_av.clientId,data:"Llamando a EA"},e=JSON.parse(localStorage.getItem("companies"));console.log(e);var a;$.grep(e,function(t){console.log("-"+t.nombre),t.nombre==myLocalStorage.getItem("prestador_av")&&(a=t.telefono)}),EAB.send({client:EAB.client,topicId:"/Clientes/"+client.clientId,message:JSON.stringify(t)}),console.log("compañia:"+myLocalStorage.getItem("prestador_av")),console.log("telefono compañia:"+a),window.location.href="tel:"+a,console.log("llamando....")},EA.attachEvents=function(){$("#enviarRegistro").click(function(){console.log("validando....");var t=$("#txtNombre_reg_av").val(),e=$("#txtRut_reg_av").val(),a=$("#txtFec_nac").val();EA.validate(t)&&EA.validate(e)&&EA.validate(a)&&EA.Rut(e)?(EA.registerUser(),window.location.replace("solicita1.html")):(EA.validate(t)?$("#txtNombre_reg_av").css("background-color","#fff"):($("#txtNombre_reg_av").css("background-color","#ffebe5"),$("#txtNombre_reg_av").attr("placeholder","Debe ingresar Nombre")),EA.validate(e)?$("#txtRut_reg_av").css("background-color","#fff"):($("#txtRut_reg_av").css("background-color","#ffebe5"),$("#txtRut_reg_av").attr("placeholder","Debe ingresar Rut")),EA.validate(a)?$("#txtFec_nac").css("background-color","#fff"):($("#txtFec_nac").css("background-color","#ffebe5"),$("#txtFec_nac").attr("placeholder","Debe ingresar Fecha de Nacimiento")),EA.Rut(e)?$("#txtRut_reg_av").css("background-color","#fff"):($("#txtRut_reg_av").css("background-color","#ffebe5"),$("#txtRut_reg_av").attr("placeholder","Debe ingresar un rut valido")))})},EA.validate=function(t){return iValid=!1,iValid=""==t?!1:!0,iValid},EA.startSession=function(){client=new EAB.createClient(EASync_av.clientId);var t={type:1,clientId:EASync_av.clientId,data:"OK"};client.connect({onSuccess:function(){client.subscribe("/Clientes/"+EASync_av.clientId),EAB.send({client:client,topicId:"/Clientes",message:JSON.stringify(t)})}}),client.onConnectionLost=function(){},client.onMessageArrived=function(){}},EA.init=function(){EA.sync(),EA.startSession(),EA.attachEvents(),EA.validaUsuario()&&(myLocalStorage.setItem("solEnviada_viaje","0"),window.location.replace("solicita1.html"))},EA.Rut=function(t){var e=t,a=e.search(/-/i),o=!1;if(7==a||8==a){var c=e.split("-");T=c[0];for(var i,r=0,n=1;T;T=Math.floor(T/10))n=(n+T%10*(9-r++%6))%11,i=n?n-1:"k";i.toString().toUpperCase()==c[1].toString().toUpperCase()&&(o=!0)}return console.log(o),o},EA.validaEmail=function(t){expr=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;var e=!0;return expr.test(t)||(e=!1),e};